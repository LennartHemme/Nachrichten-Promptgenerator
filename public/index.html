<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mittagsupdate Promptgenerator</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header>
    <h1>üóûÔ∏è Promptgenerator</h1>
  </header>
  <main>
    <section id="artikelListe">Artikel werden geladen‚Ä¶</section>

    <section id="promptArea" style="display:none">
      <label>Autor/in: <input id="autorInput" placeholder="Vorname Nachname" /></label><br/>
      <label>Begr√ºndung f√ºr Hintergrund (optional):<br/>
        <textarea id="begruendungInput"></textarea>
      </label><br/>
      <button onclick="generatePrompt()">üìã Prompt erzeugen</button>
      <pre id="output"></pre>
    </section>
  </main>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://fwqzalxpezqdkplgudix.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3cXphbHhwZXpxZGtwbGd1ZGl4Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDI4NTUwMywiZXhwIjoyMDU5ODYxNTAzfQ.U-w5Nye44FALf8aH2VDMrVaJ_wsIJ4cyimhp_nGU07o'
    );

    async function ladeArtikel() {
      const seitGestern = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();
      const { data, error } = await supabase
        .from("artikel")
        .select("id,titel,beschreibung,zeitstempel")
        .gte("zeitstempel", seitGestern)
        .order("zeitstempel", { ascending: false });

      const liste = document.getElementById("artikelListe");
      if (error || !data.length) {
        liste.innerHTML = "‚ùå Keine Artikel gefunden.";
        return;
      }

      liste.innerHTML = "<h2>üì∞ Artikel√ºbersicht</h2>";
      data.forEach(art => {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <label>
            <input type="checkbox" value="${art.id}" class="artikelCheck"> <b>${art.titel}</b><br>
            <small>${new Date(art.zeitstempel).toLocaleString()}</small><br>
            <i>${art.beschreibung}</i>
          </label>
        `;
        liste.appendChild(el);
      });
      document.getElementById("promptArea").style.display = "block";
    }

    window.generatePrompt = async function () {
      const artikelIds = [...document.querySelectorAll(".artikelCheck:checked")].map(cb => cb.value);
      const autorName = document.getElementById("autorInput").value;
      const hintergrundBegruendung = document.getElementById("begruendungInput").value;

      const res = await fetch("/api/prompt", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ artikelIds, autorName, hintergrundBegruendung })
      });
      const result = await res.json();
      document.getElementById("output").textContent = result.prompt || result.error;
    }

    ladeArtikel();
  </script>
</body>
</html>
